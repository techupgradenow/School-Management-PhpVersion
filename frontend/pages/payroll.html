<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Payroll Management - EduManage Pro</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link rel="stylesheet" href="../assets/css/style.css">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="../assets/js/app.js"></script>
	<script src="../assets/js/dynamic-dropdown.js"></script>
	<style>
		.payroll-container {
			padding: 24px;
			max-width: 1600px;
			margin: 0 auto;
		}

		.page-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 24px;
			flex-wrap: wrap;
			gap: 16px;
		}

		.page-header h1 {
			font-size: 28px;
			font-weight: 700;
			color: #1e293b;
			display: flex;
			align-items: center;
			gap: 12px;
		}

		.page-header h1 i {
			color: #10b981;
		}

		.header-actions {
			display: flex;
			gap: 12px;
			flex-wrap: wrap;
		}

		/* Stats Cards */
		.payroll-stats {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
			gap: 20px;
			margin-bottom: 24px;
		}

		.stat-card {
			background: white;
			border-radius: 16px;
			padding: 24px;
			box-shadow: 0 4px 15px rgba(0,0,0,0.05);
			display: flex;
			align-items: center;
			gap: 16px;
			transition: transform 0.2s, box-shadow 0.2s;
		}

		.stat-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 8px 25px rgba(0,0,0,0.1);
		}

		.stat-icon {
			width: 60px;
			height: 60px;
			border-radius: 14px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 24px;
		}

		.stat-icon.green { background: linear-gradient(135deg, #10b981, #059669); color: white; }
		.stat-icon.blue { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
		.stat-icon.orange { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
		.stat-icon.purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; }
		.stat-icon.red { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }

		.stat-info h3 {
			font-size: 13px;
			color: #64748b;
			font-weight: 500;
			margin-bottom: 4px;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		.stat-info .value {
			font-size: 28px;
			font-weight: 700;
			color: #1e293b;
		}

		.stat-info .sub-text {
			font-size: 12px;
			color: #94a3b8;
			margin-top: 4px;
		}

		/* Filters */
		.filter-section {
			background: white;
			border-radius: 16px;
			padding: 20px;
			margin-bottom: 24px;
			box-shadow: 0 4px 15px rgba(0,0,0,0.05);
		}

		.filter-row {
			display: flex;
			gap: 16px;
			flex-wrap: wrap;
			align-items: flex-end;
		}

		.filter-group {
			display: flex;
			flex-direction: column;
			gap: 6px;
		}

		.filter-group label {
			font-size: 12px;
			font-weight: 600;
			color: #64748b;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		.filter-group select,
		.filter-group input {
			padding: 10px 14px;
			border: 2px solid #e2e8f0;
			border-radius: 10px;
			font-size: 14px;
			min-width: 160px;
			transition: border-color 0.2s;
		}

		.filter-group select:focus,
		.filter-group input:focus {
			outline: none;
			border-color: #10b981;
		}

		/* Payroll Table */
		.payroll-table-container {
			background: white;
			border-radius: 16px;
			box-shadow: 0 4px 15px rgba(0,0,0,0.05);
			overflow: hidden;
		}

		.table-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 20px 24px;
			border-bottom: 1px solid #f1f5f9;
			flex-wrap: wrap;
			gap: 12px;
		}

		.table-header h2 {
			font-size: 18px;
			font-weight: 600;
			color: #1e293b;
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.table-actions {
			display: flex;
			gap: 10px;
			flex-wrap: wrap;
		}

		.search-box {
			position: relative;
		}

		.search-box input {
			padding: 10px 14px 10px 40px;
			border: 2px solid #e2e8f0;
			border-radius: 10px;
			font-size: 14px;
			width: 250px;
			transition: border-color 0.2s;
		}

		.search-box input:focus {
			outline: none;
			border-color: #10b981;
		}

		.search-box i {
			position: absolute;
			left: 14px;
			top: 50%;
			transform: translateY(-50%);
			color: #94a3b8;
		}

		.payroll-table {
			width: 100%;
			border-collapse: collapse;
		}

		.payroll-table th {
			background: #f8fafc;
			padding: 14px 16px;
			text-align: left;
			font-size: 12px;
			font-weight: 600;
			color: #64748b;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			border-bottom: 2px solid #e2e8f0;
		}

		.payroll-table td {
			padding: 16px;
			border-bottom: 1px solid #f1f5f9;
			font-size: 14px;
			color: #334155;
		}

		.payroll-table tr:hover {
			background: #f8fafc;
		}

		.employee-info {
			display: flex;
			align-items: center;
			gap: 12px;
		}

		.employee-avatar {
			width: 44px;
			height: 44px;
			border-radius: 12px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: 600;
			font-size: 16px;
			color: white;
		}

		.employee-details h4 {
			font-weight: 600;
			color: #1e293b;
			margin-bottom: 2px;
		}

		.employee-details span {
			font-size: 12px;
			color: #64748b;
		}

		.salary-amount {
			font-weight: 600;
			color: #10b981;
		}

		.salary-breakdown {
			font-size: 11px;
			color: #94a3b8;
		}

		.status-badge {
			display: inline-flex;
			align-items: center;
			gap: 6px;
			padding: 6px 12px;
			border-radius: 20px;
			font-size: 12px;
			font-weight: 600;
		}

		.status-badge.paid {
			background: #dcfce7;
			color: #16a34a;
		}

		.status-badge.pending {
			background: #fef3c7;
			color: #d97706;
		}

		.status-badge.processing {
			background: #dbeafe;
			color: #2563eb;
		}

		.status-badge.hold {
			background: #fee2e2;
			color: #dc2626;
		}

		.action-buttons {
			display: flex;
			gap: 8px;
		}

		.action-btn {
			width: 36px;
			height: 36px;
			border-radius: 10px;
			border: none;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.2s;
		}

		.action-btn.view { background: #dbeafe; color: #2563eb; }
		.action-btn.view:hover { background: #2563eb; color: white; }
		.action-btn.edit { background: #fef3c7; color: #d97706; }
		.action-btn.edit:hover { background: #d97706; color: white; }
		.action-btn.pay { background: #dcfce7; color: #16a34a; }
		.action-btn.pay:hover { background: #16a34a; color: white; }
		.action-btn.print { background: #f3e8ff; color: #7c3aed; }
		.action-btn.print:hover { background: #7c3aed; color: white; }
		.action-btn.delete { background: #fee2e2; color: #dc2626; }
		.action-btn.delete:hover { background: #dc2626; color: white; }

		/* Buttons */
		.btn {
			padding: 10px 20px;
			border-radius: 10px;
			font-size: 14px;
			font-weight: 600;
			cursor: pointer;
			display: inline-flex;
			align-items: center;
			gap: 8px;
			transition: all 0.2s;
			border: none;
		}

		.btn-primary {
			background: linear-gradient(135deg, #10b981, #059669);
			color: white;
		}

		.btn-primary:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
		}

		.btn-secondary {
			background: white;
			color: #64748b;
			border: 2px solid #e2e8f0;
		}

		.btn-secondary:hover {
			border-color: #10b981;
			color: #10b981;
		}

		.btn-danger {
			background: linear-gradient(135deg, #ef4444, #dc2626);
			color: white;
		}

		/* Modal Styles */
		.modal-overlay {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0,0,0,0.5);
			display: none;
			align-items: center;
			justify-content: center;
			z-index: 1000;
			padding: 20px;
		}

		.modal-overlay.active {
			display: flex;
		}

		.modal-container {
			background: white;
			border-radius: 20px;
			width: 100%;
			max-width: 700px;
			max-height: 90vh;
			overflow-y: auto;
			box-shadow: 0 25px 50px rgba(0,0,0,0.25);
		}

		.modal-header {
			padding: 24px;
			border-bottom: 1px solid #f1f5f9;
			display: flex;
			justify-content: space-between;
			align-items: center;
			background: linear-gradient(135deg, #10b981, #059669);
			color: white;
			border-radius: 20px 20px 0 0;
		}

		.modal-header h3 {
			font-size: 20px;
			font-weight: 600;
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.modal-close {
			width: 36px;
			height: 36px;
			border-radius: 50%;
			border: none;
			background: rgba(255,255,255,0.2);
			color: white;
			font-size: 20px;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: background 0.2s;
		}

		.modal-close:hover {
			background: rgba(255,255,255,0.3);
		}

		.modal-body {
			padding: 24px;
		}

		.form-row {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 20px;
			margin-bottom: 20px;
		}

		.form-row.single {
			grid-template-columns: 1fr;
		}

		.form-group {
			display: flex;
			flex-direction: column;
			gap: 8px;
		}

		.form-group label {
			font-size: 13px;
			font-weight: 600;
			color: #374151;
		}

		.form-group label .required {
			color: #ef4444;
		}

		.form-group input,
		.form-group select,
		.form-group textarea {
			padding: 12px 16px;
			border: 2px solid #e2e8f0;
			border-radius: 10px;
			font-size: 14px;
			transition: border-color 0.2s;
		}

		.form-group input:focus,
		.form-group select:focus,
		.form-group textarea:focus {
			outline: none;
			border-color: #10b981;
		}

		.form-section {
			background: #f8fafc;
			border-radius: 12px;
			padding: 20px;
			margin-bottom: 20px;
		}

		.form-section h4 {
			font-size: 14px;
			font-weight: 600;
			color: #1e293b;
			margin-bottom: 16px;
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.salary-summary {
			background: linear-gradient(135deg, #10b981, #059669);
			color: white;
			border-radius: 12px;
			padding: 20px;
			margin-top: 20px;
		}

		.salary-summary h4 {
			font-size: 14px;
			margin-bottom: 12px;
			opacity: 0.9;
		}

		.salary-row {
			display: flex;
			justify-content: space-between;
			padding: 8px 0;
			border-bottom: 1px solid rgba(255,255,255,0.2);
		}

		.salary-row:last-child {
			border-bottom: none;
			font-size: 18px;
			font-weight: 700;
			padding-top: 12px;
		}

		.modal-footer {
			padding: 20px 24px;
			border-top: 1px solid #f1f5f9;
			display: flex;
			justify-content: flex-end;
			gap: 12px;
		}

		/* Pagination */
		.pagination {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 16px 24px;
			border-top: 1px solid #f1f5f9;
		}

		.pagination-info {
			font-size: 14px;
			color: #64748b;
		}

		.pagination-buttons {
			display: flex;
			gap: 8px;
		}

		.page-btn {
			width: 36px;
			height: 36px;
			border-radius: 8px;
			border: 2px solid #e2e8f0;
			background: white;
			color: #64748b;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.2s;
		}

		.page-btn:hover, .page-btn.active {
			background: #10b981;
			border-color: #10b981;
			color: white;
		}

		/* Payslip Print Style */
		.payslip-container {
			background: white;
			padding: 40px;
			max-width: 800px;
			margin: 0 auto;
		}

		.payslip-header {
			text-align: center;
			border-bottom: 2px solid #1e293b;
			padding-bottom: 20px;
			margin-bottom: 20px;
		}

		.payslip-header h1 {
			font-size: 24px;
			color: #1e293b;
		}

		.payslip-header p {
			color: #64748b;
		}

		@media print {
			.sidebar, .header-actions, .filter-section, .table-actions, .action-buttons, .pagination {
				display: none !important;
			}
			.payroll-container {
				padding: 0;
			}
		}

		/* Empty State */
		.empty-state {
			text-align: center;
			padding: 60px 20px;
		}

		.empty-state i {
			font-size: 64px;
			color: #e2e8f0;
			margin-bottom: 20px;
		}

		.empty-state h3 {
			font-size: 20px;
			color: #64748b;
			margin-bottom: 8px;
		}

		.empty-state p {
			color: #94a3b8;
		}
	</style>
</head>
<body>
	<div class="app-container">
		<!-- Sidebar -->
		<nav class="sidebar" id="sidebar">
			<div class="sidebar-header">
				<div class="logo">
					<div class="logo-icon"><i class="fas fa-graduation-cap"></i></div>
					<span class="logo-text">EduManage</span>
				</div>
			</div>
			<ul class="nav-menu">
				<li class="nav-item"><a href="dashboard.html"><i class="fas fa-th-large"></i><span>Dashboard</span></a></li>
				<li class="nav-item"><a href="students.html"><i class="fas fa-user-graduate"></i><span>Students</span></a></li>
				<li class="nav-item"><a href="teachers.html"><i class="fas fa-chalkboard-teacher"></i><span>Teachers</span></a></li>
				<li class="nav-item"><a href="exams.html"><i class="fas fa-file-alt"></i><span>Exams</span></a></li>
				<li class="nav-item"><a href="fees.html"><i class="fas fa-rupee-sign"></i><span>Fees</span></a></li>
				<li class="nav-item active"><a href="payroll.html"><i class="fas fa-money-check-alt"></i><span>Payroll</span></a></li>
				<li class="nav-item"><a href="settings.html"><i class="fas fa-cog"></i><span>Settings</span></a></li>
			</ul>
		</nav>

		<!-- Main Content -->
		<main class="main-content">
			<div class="payroll-container">
				<!-- Page Header -->
				<div class="page-header">
					<h1><i class="fas fa-money-check-alt"></i> Payroll Management</h1>
					<div class="header-actions">
						<button class="btn btn-secondary" onclick="generatePayrollReport()">
							<i class="fas fa-file-export"></i> Export Report
						</button>
						<button class="btn btn-secondary" onclick="processAllPayroll()">
							<i class="fas fa-sync-alt"></i> Process All
						</button>
						<button class="btn btn-primary" onclick="openPayrollModal()">
							<i class="fas fa-plus"></i> Add Salary Record
						</button>
					</div>
				</div>

				<!-- Stats Cards -->
				<div class="payroll-stats">
					<div class="stat-card">
						<div class="stat-icon green">
							<i class="fas fa-users"></i>
						</div>
						<div class="stat-info">
							<h3>Total Employees</h3>
							<div class="value" id="totalEmployees">0</div>
							<div class="sub-text">Active staff members</div>
						</div>
					</div>
					<div class="stat-card">
						<div class="stat-icon blue">
							<i class="fas fa-wallet"></i>
						</div>
						<div class="stat-info">
							<h3>Total Payroll</h3>
							<div class="value" id="totalPayroll">₹0</div>
							<div class="sub-text">This month</div>
						</div>
					</div>
					<div class="stat-card">
						<div class="stat-icon orange">
							<i class="fas fa-clock"></i>
						</div>
						<div class="stat-info">
							<h3>Pending</h3>
							<div class="value" id="pendingPayroll">0</div>
							<div class="sub-text">Awaiting payment</div>
						</div>
					</div>
					<div class="stat-card">
						<div class="stat-icon purple">
							<i class="fas fa-check-circle"></i>
						</div>
						<div class="stat-info">
							<h3>Paid</h3>
							<div class="value" id="paidPayroll">0</div>
							<div class="sub-text">This month</div>
						</div>
					</div>
				</div>

				<!-- Filters -->
				<div class="filter-section">
					<div class="filter-row">
						<div class="filter-group">
							<label>Month</label>
							<select id="filterMonth">
								<option value="">All Months</option>
								<option value="01">January</option>
								<option value="02">February</option>
								<option value="03">March</option>
								<option value="04">April</option>
								<option value="05">May</option>
								<option value="06">June</option>
								<option value="07">July</option>
								<option value="08">August</option>
								<option value="09">September</option>
								<option value="10">October</option>
								<option value="11">November</option>
								<option value="12">December</option>
							</select>
						</div>
						<div class="filter-group">
							<label>Year</label>
							<select id="filterYear">
								<option value="2024">2024</option>
								<option value="2025" selected>2025</option>
							</select>
						</div>
						<div class="filter-group">
							<label>Department</label>
							<select id="filterDepartment" data-dropdown="designation">
								<option value="">All Departments</option>
							</select>
						</div>
						<div class="filter-group">
							<label>Status</label>
							<select id="filterStatus">
								<option value="">All Status</option>
								<option value="paid">Paid</option>
								<option value="pending">Pending</option>
								<option value="processing">Processing</option>
								<option value="hold">On Hold</option>
							</select>
						</div>
						<div class="filter-group">
							<button class="btn btn-secondary" onclick="resetFilters()">
								<i class="fas fa-undo"></i> Reset
							</button>
						</div>
					</div>
				</div>

				<!-- Payroll Table -->
				<div class="payroll-table-container">
					<div class="table-header">
						<h2><i class="fas fa-list"></i> Salary Records</h2>
						<div class="table-actions">
							<div class="search-box">
								<i class="fas fa-search"></i>
								<input type="text" id="searchPayroll" placeholder="Search employee...">
							</div>
						</div>
					</div>
					<table class="payroll-table">
						<thead>
							<tr>
								<th><input type="checkbox" id="selectAll"></th>
								<th>Employee</th>
								<th>Designation</th>
								<th>Basic Salary</th>
								<th>Allowances</th>
								<th>Deductions</th>
								<th>Net Salary</th>
								<th>Status</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody id="payrollTableBody">
							<!-- Payroll records will be loaded here -->
						</tbody>
					</table>
					<div class="pagination">
						<div class="pagination-info">
							Showing <span id="showingStart">0</span> to <span id="showingEnd">0</span> of <span id="totalRecords">0</span> records
						</div>
						<div class="pagination-buttons">
							<button class="page-btn" id="prevPage"><i class="fas fa-chevron-left"></i></button>
							<button class="page-btn active">1</button>
							<button class="page-btn" id="nextPage"><i class="fas fa-chevron-right"></i></button>
						</div>
					</div>
				</div>
			</div>
		</main>
	</div>

	<!-- Add/Edit Payroll Modal -->
	<div class="modal-overlay" id="payrollModal">
		<div class="modal-container">
			<div class="modal-header">
				<h3><i class="fas fa-money-check-alt"></i> <span id="modalTitle">Add Salary Record</span></h3>
				<button class="modal-close" onclick="closePayrollModal()">&times;</button>
			</div>
			<div class="modal-body">
				<form id="payrollForm">
					<input type="hidden" id="payrollId">

					<!-- Employee Selection -->
					<div class="form-section">
						<h4><i class="fas fa-user"></i> Employee Information</h4>
						<div class="form-row">
							<div class="form-group">
								<label>Select Employee <span class="required">*</span></label>
								<select id="employeeSelect" required>
									<option value="">Choose Employee...</option>
								</select>
							</div>
							<div class="form-group">
								<label>Pay Period <span class="required">*</span></label>
								<input type="month" id="payPeriod" required>
							</div>
						</div>
					</div>

					<!-- Earnings -->
					<div class="form-section">
						<h4><i class="fas fa-plus-circle"></i> Earnings</h4>
						<div class="form-row">
							<div class="form-group">
								<label>Basic Salary <span class="required">*</span></label>
								<input type="number" id="basicSalary" placeholder="0.00" required onchange="calculateNetSalary()">
							</div>
							<div class="form-group">
								<label>House Rent Allowance (HRA)</label>
								<input type="number" id="hra" placeholder="0.00" value="0" onchange="calculateNetSalary()">
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label>Dearness Allowance (DA)</label>
								<input type="number" id="da" placeholder="0.00" value="0" onchange="calculateNetSalary()">
							</div>
							<div class="form-group">
								<label>Transport Allowance</label>
								<input type="number" id="transportAllowance" placeholder="0.00" value="0" onchange="calculateNetSalary()">
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label>Medical Allowance</label>
								<input type="number" id="medicalAllowance" placeholder="0.00" value="0" onchange="calculateNetSalary()">
							</div>
							<div class="form-group">
								<label>Other Allowances</label>
								<input type="number" id="otherAllowances" placeholder="0.00" value="0" onchange="calculateNetSalary()">
							</div>
						</div>
					</div>

					<!-- Deductions -->
					<div class="form-section">
						<h4><i class="fas fa-minus-circle"></i> Deductions</h4>
						<div class="form-row">
							<div class="form-group">
								<label>Provident Fund (PF)</label>
								<input type="number" id="pf" placeholder="0.00" value="0" onchange="calculateNetSalary()">
							</div>
							<div class="form-group">
								<label>Professional Tax</label>
								<input type="number" id="professionalTax" placeholder="0.00" value="0" onchange="calculateNetSalary()">
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label>Income Tax (TDS)</label>
								<input type="number" id="tds" placeholder="0.00" value="0" onchange="calculateNetSalary()">
							</div>
							<div class="form-group">
								<label>Other Deductions</label>
								<input type="number" id="otherDeductions" placeholder="0.00" value="0" onchange="calculateNetSalary()">
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label>Leave Deduction (Days)</label>
								<input type="number" id="leaveDays" placeholder="0" value="0" min="0" onchange="calculateNetSalary()">
							</div>
							<div class="form-group">
								<label>Loan EMI</label>
								<input type="number" id="loanEmi" placeholder="0.00" value="0" onchange="calculateNetSalary()">
							</div>
						</div>
					</div>

					<!-- Salary Summary -->
					<div class="salary-summary">
						<h4><i class="fas fa-calculator"></i> Salary Summary</h4>
						<div class="salary-row">
							<span>Gross Earnings</span>
							<span id="grossEarnings">₹0.00</span>
						</div>
						<div class="salary-row">
							<span>Total Deductions</span>
							<span id="totalDeductions">₹0.00</span>
						</div>
						<div class="salary-row">
							<span>Net Salary</span>
							<span id="netSalary">₹0.00</span>
						</div>
					</div>

					<!-- Payment Details -->
					<div class="form-section" style="margin-top: 20px;">
						<h4><i class="fas fa-credit-card"></i> Payment Details</h4>
						<div class="form-row">
							<div class="form-group">
								<label>Payment Mode</label>
								<select id="paymentMode" data-dropdown="payment_mode">
									<option value="">Select Payment Mode</option>
								</select>
							</div>
							<div class="form-group">
								<label>Status</label>
								<select id="paymentStatus">
									<option value="pending">Pending</option>
									<option value="processing">Processing</option>
									<option value="paid">Paid</option>
									<option value="hold">On Hold</option>
								</select>
							</div>
						</div>
						<div class="form-row single">
							<div class="form-group">
								<label>Remarks</label>
								<textarea id="paymentRemarks" rows="2" placeholder="Any additional notes..."></textarea>
							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button class="btn btn-secondary" onclick="closePayrollModal()">Cancel</button>
				<button class="btn btn-primary" onclick="savePayroll()">
					<i class="fas fa-save"></i> Save Record
				</button>
			</div>
		</div>
	</div>

	<!-- View Payslip Modal -->
	<div class="modal-overlay" id="payslipModal">
		<div class="modal-container" style="max-width: 900px;">
			<div class="modal-header">
				<h3><i class="fas fa-file-invoice-dollar"></i> Payslip</h3>
				<button class="modal-close" onclick="closePayslipModal()">&times;</button>
			</div>
			<div class="modal-body" id="payslipContent">
				<!-- Payslip content will be generated here -->
			</div>
			<div class="modal-footer">
				<button class="btn btn-secondary" onclick="closePayslipModal()">Close</button>
				<button class="btn btn-primary" onclick="printPayslip()">
					<i class="fas fa-print"></i> Print Payslip
				</button>
			</div>
		</div>
	</div>

	<script>
		const API_BASE_URL = '../backend/api';
		const PAYROLL_KEY = 'edu_payroll';
		const TEACHERS_KEY = 'edu_teachers';

		let payrollRecords = [];
		let teachers = [];
		let currentPage = 1;
		let pageSize = 10;

		// Initialize
		$(document).ready(function() {
			loadTeachers();
			loadPayrollRecords();
			setCurrentMonth();

			// Event listeners
			$('#searchPayroll').on('input', renderTable);
			$('#filterMonth, #filterYear, #filterStatus, #filterDepartment').on('change', renderTable);
			$('#selectAll').on('change', toggleSelectAll);
		});

		function setCurrentMonth() {
			const now = new Date();
			const month = String(now.getMonth() + 1).padStart(2, '0');
			const year = now.getFullYear();
			$('#filterMonth').val(month);
			$('#filterYear').val(year);
			$('#payPeriod').val(`${year}-${month}`);
		}

		function loadTeachers() {
			// Try API first
			$.ajax({
				url: API_BASE_URL + '/teachers.php',
				type: 'GET',
				dataType: 'json',
				success: function(response) {
					if (response.success) {
						teachers = response.data || [];
					} else {
						teachers = JSON.parse(localStorage.getItem(TEACHERS_KEY)) || [];
					}
					populateEmployeeDropdown();
				},
				error: function() {
					teachers = JSON.parse(localStorage.getItem(TEACHERS_KEY)) || getDemoTeachers();
					populateEmployeeDropdown();
				}
			});
		}

		function getDemoTeachers() {
			return [
				{ id: 'TCH001', name: 'Rajesh Kumar', designation: 'Principal', subject: 'Administration', email: 'rajesh@school.edu', salary: 85000 },
				{ id: 'TCH002', name: 'Priya Sharma', designation: 'Senior Teacher', subject: 'Mathematics', email: 'priya@school.edu', salary: 55000 },
				{ id: 'TCH003', name: 'Amit Patel', designation: 'Teacher', subject: 'Science', email: 'amit@school.edu', salary: 45000 },
				{ id: 'TCH004', name: 'Sunita Gupta', designation: 'Teacher', subject: 'English', email: 'sunita@school.edu', salary: 42000 },
				{ id: 'TCH005', name: 'Vikram Singh', designation: 'HOD', subject: 'Physics', email: 'vikram@school.edu', salary: 60000 },
				{ id: 'TCH006', name: 'Anita Reddy', designation: 'Teacher', subject: 'Chemistry', email: 'anita@school.edu', salary: 45000 },
				{ id: 'TCH007', name: 'Mohd. Farhan', designation: 'Lab Assistant', subject: 'Lab', email: 'farhan@school.edu', salary: 28000 },
				{ id: 'TCH008', name: 'Kavita Nair', designation: 'Librarian', subject: 'Library', email: 'kavita@school.edu', salary: 32000 }
			];
		}

		function populateEmployeeDropdown() {
			const $select = $('#employeeSelect');
			$select.empty().append('<option value="">Choose Employee...</option>');
			teachers.forEach(t => {
				$select.append(`<option value="${t.id}" data-salary="${t.salary || 0}">${t.name} - ${t.designation || 'Staff'}</option>`);
			});
		}

		function loadPayrollRecords() {
			// Try API first
			$.ajax({
				url: API_BASE_URL + '/payroll.php',
				type: 'GET',
				dataType: 'json',
				success: function(response) {
					if (response.success) {
						payrollRecords = response.data || [];
					} else {
						payrollRecords = JSON.parse(localStorage.getItem(PAYROLL_KEY)) || generateDemoPayroll();
					}
					updateStats();
					renderTable();
				},
				error: function() {
					payrollRecords = JSON.parse(localStorage.getItem(PAYROLL_KEY)) || generateDemoPayroll();
					updateStats();
					renderTable();
				}
			});
		}

		function generateDemoPayroll() {
			const demoTeachers = getDemoTeachers();
			const now = new Date();
			const month = String(now.getMonth() + 1).padStart(2, '0');
			const year = now.getFullYear();

			return demoTeachers.map((t, i) => {
				const basic = t.salary || 40000;
				const hra = Math.round(basic * 0.2);
				const da = Math.round(basic * 0.1);
				const transport = 2000;
				const medical = 1500;
				const pf = Math.round(basic * 0.12);
				const tax = Math.round(basic * 0.05);
				const gross = basic + hra + da + transport + medical;
				const deductions = pf + tax;

				return {
					id: 'PAY' + String(i + 1).padStart(4, '0'),
					employeeId: t.id,
					employeeName: t.name,
					designation: t.designation,
					payPeriod: `${year}-${month}`,
					basic: basic,
					hra: hra,
					da: da,
					transport: transport,
					medical: medical,
					otherAllowances: 0,
					pf: pf,
					professionalTax: 200,
					tds: tax,
					otherDeductions: 0,
					leaveDays: 0,
					leaveDeduction: 0,
					loanEmi: 0,
					grossEarnings: gross,
					totalDeductions: deductions + 200,
					netSalary: gross - deductions - 200,
					paymentMode: 'Bank Transfer',
					status: i < 5 ? 'paid' : 'pending',
					paidDate: i < 5 ? `${year}-${month}-28` : null,
					remarks: ''
				};
			});
		}

		function updateStats() {
			const month = $('#filterMonth').val();
			const year = $('#filterYear').val();

			let filtered = payrollRecords;
			if (month && year) {
				filtered = payrollRecords.filter(p => p.payPeriod === `${year}-${month}`);
			}

			const totalEmployees = teachers.length;
			const totalPayroll = filtered.reduce((sum, p) => sum + (p.netSalary || 0), 0);
			const pending = filtered.filter(p => p.status === 'pending' || p.status === 'processing').length;
			const paid = filtered.filter(p => p.status === 'paid').length;

			$('#totalEmployees').text(totalEmployees);
			$('#totalPayroll').text('₹' + totalPayroll.toLocaleString('en-IN'));
			$('#pendingPayroll').text(pending);
			$('#paidPayroll').text(paid);
		}

		function renderTable() {
			const search = $('#searchPayroll').val().toLowerCase();
			const month = $('#filterMonth').val();
			const year = $('#filterYear').val();
			const status = $('#filterStatus').val();
			const department = $('#filterDepartment').val();

			let filtered = payrollRecords.filter(p => {
				const matchSearch = !search ||
					p.employeeName.toLowerCase().includes(search) ||
					p.employeeId.toLowerCase().includes(search) ||
					p.designation.toLowerCase().includes(search);
				const matchMonth = !month || !year || p.payPeriod === `${year}-${month}`;
				const matchStatus = !status || p.status === status;
				const matchDept = !department || p.designation === department;
				return matchSearch && matchMonth && matchStatus && matchDept;
			});

			const total = filtered.length;
			const totalPages = Math.max(1, Math.ceil(total / pageSize));
			currentPage = Math.min(currentPage, totalPages);

			const start = (currentPage - 1) * pageSize;
			const pageData = filtered.slice(start, start + pageSize);

			const tbody = $('#payrollTableBody');
			tbody.empty();

			if (pageData.length === 0) {
				tbody.html(`
					<tr>
						<td colspan="9">
							<div class="empty-state">
								<i class="fas fa-money-check-alt"></i>
								<h3>No Payroll Records Found</h3>
								<p>Add salary records or adjust your filters</p>
							</div>
						</td>
					</tr>
				`);
			} else {
				pageData.forEach(p => {
					const avatarColor = getAvatarColor(p.employeeName);
					const initials = getInitials(p.employeeName);
					const statusClass = p.status;
					const statusIcon = p.status === 'paid' ? 'check-circle' :
									   p.status === 'pending' ? 'clock' :
									   p.status === 'processing' ? 'sync-alt' : 'pause-circle';

					tbody.append(`
						<tr>
							<td><input type="checkbox" class="record-checkbox" data-id="${p.id}"></td>
							<td>
								<div class="employee-info">
									<div class="employee-avatar" style="background: ${avatarColor}">${initials}</div>
									<div class="employee-details">
										<h4>${p.employeeName}</h4>
										<span>${p.employeeId}</span>
									</div>
								</div>
							</td>
							<td>${p.designation}</td>
							<td>
								<div class="salary-amount">₹${p.basic.toLocaleString('en-IN')}</div>
							</td>
							<td>
								<div class="salary-amount" style="color: #10b981;">+₹${(p.grossEarnings - p.basic).toLocaleString('en-IN')}</div>
								<div class="salary-breakdown">HRA, DA, etc.</div>
							</td>
							<td>
								<div class="salary-amount" style="color: #ef4444;">-₹${p.totalDeductions.toLocaleString('en-IN')}</div>
								<div class="salary-breakdown">PF, Tax, etc.</div>
							</td>
							<td>
								<div class="salary-amount" style="font-size: 16px;">₹${p.netSalary.toLocaleString('en-IN')}</div>
							</td>
							<td>
								<span class="status-badge ${statusClass}">
									<i class="fas fa-${statusIcon}"></i> ${p.status.charAt(0).toUpperCase() + p.status.slice(1)}
								</span>
							</td>
							<td>
								<div class="action-buttons">
									<button class="action-btn view" title="View Payslip" onclick="viewPayslip('${p.id}')">
										<i class="fas fa-eye"></i>
									</button>
									<button class="action-btn edit" title="Edit" onclick="editPayroll('${p.id}')">
										<i class="fas fa-edit"></i>
									</button>
									${p.status !== 'paid' ? `
									<button class="action-btn pay" title="Mark as Paid" onclick="markAsPaid('${p.id}')">
										<i class="fas fa-check"></i>
									</button>
									` : ''}
									<button class="action-btn print" title="Print" onclick="printSinglePayslip('${p.id}')">
										<i class="fas fa-print"></i>
									</button>
								</div>
							</td>
						</tr>
					`);
				});
			}

			// Update pagination info
			$('#showingStart').text(total > 0 ? start + 1 : 0);
			$('#showingEnd').text(Math.min(start + pageSize, total));
			$('#totalRecords').text(total);

			updateStats();
		}

		function getAvatarColor(name) {
			const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4'];
			let hash = 0;
			for (let i = 0; i < name.length; i++) {
				hash = name.charCodeAt(i) + ((hash << 5) - hash);
			}
			return colors[Math.abs(hash) % colors.length];
		}

		function getInitials(name) {
			return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
		}

		function openPayrollModal(id = null) {
			$('#payrollForm')[0].reset();
			$('#payrollId').val('');
			$('#modalTitle').text(id ? 'Edit Salary Record' : 'Add Salary Record');
			setCurrentMonth();
			calculateNetSalary();
			$('#payrollModal').addClass('active');
		}

		function closePayrollModal() {
			$('#payrollModal').removeClass('active');
		}

		function editPayroll(id) {
			const record = payrollRecords.find(p => p.id === id);
			if (!record) return;

			$('#payrollId').val(record.id);
			$('#employeeSelect').val(record.employeeId);
			$('#payPeriod').val(record.payPeriod);
			$('#basicSalary').val(record.basic);
			$('#hra').val(record.hra);
			$('#da').val(record.da);
			$('#transportAllowance').val(record.transport);
			$('#medicalAllowance').val(record.medical);
			$('#otherAllowances').val(record.otherAllowances);
			$('#pf').val(record.pf);
			$('#professionalTax').val(record.professionalTax);
			$('#tds').val(record.tds);
			$('#otherDeductions').val(record.otherDeductions);
			$('#leaveDays').val(record.leaveDays);
			$('#loanEmi').val(record.loanEmi);
			$('#paymentMode').val(record.paymentMode);
			$('#paymentStatus').val(record.status);
			$('#paymentRemarks').val(record.remarks);

			$('#modalTitle').text('Edit Salary Record');
			calculateNetSalary();
			$('#payrollModal').addClass('active');
		}

		function calculateNetSalary() {
			const basic = parseFloat($('#basicSalary').val()) || 0;
			const hra = parseFloat($('#hra').val()) || 0;
			const da = parseFloat($('#da').val()) || 0;
			const transport = parseFloat($('#transportAllowance').val()) || 0;
			const medical = parseFloat($('#medicalAllowance').val()) || 0;
			const otherAllowances = parseFloat($('#otherAllowances').val()) || 0;

			const pf = parseFloat($('#pf').val()) || 0;
			const professionalTax = parseFloat($('#professionalTax').val()) || 0;
			const tds = parseFloat($('#tds').val()) || 0;
			const otherDeductions = parseFloat($('#otherDeductions').val()) || 0;
			const leaveDays = parseInt($('#leaveDays').val()) || 0;
			const loanEmi = parseFloat($('#loanEmi').val()) || 0;

			const perDaySalary = basic / 30;
			const leaveDeduction = perDaySalary * leaveDays;

			const grossEarnings = basic + hra + da + transport + medical + otherAllowances;
			const totalDeductions = pf + professionalTax + tds + otherDeductions + leaveDeduction + loanEmi;
			const netSalary = grossEarnings - totalDeductions;

			$('#grossEarnings').text('₹' + grossEarnings.toLocaleString('en-IN', {minimumFractionDigits: 2}));
			$('#totalDeductions').text('₹' + totalDeductions.toLocaleString('en-IN', {minimumFractionDigits: 2}));
			$('#netSalary').text('₹' + netSalary.toLocaleString('en-IN', {minimumFractionDigits: 2}));
		}

		function savePayroll() {
			const employeeId = $('#employeeSelect').val();
			const employee = teachers.find(t => t.id === employeeId);

			if (!employeeId || !employee) {
				notify('Please select an employee', 'error');
				return;
			}

			const basic = parseFloat($('#basicSalary').val()) || 0;
			if (basic <= 0) {
				notify('Please enter basic salary', 'error');
				return;
			}

			const hra = parseFloat($('#hra').val()) || 0;
			const da = parseFloat($('#da').val()) || 0;
			const transport = parseFloat($('#transportAllowance').val()) || 0;
			const medical = parseFloat($('#medicalAllowance').val()) || 0;
			const otherAllowances = parseFloat($('#otherAllowances').val()) || 0;
			const pf = parseFloat($('#pf').val()) || 0;
			const professionalTax = parseFloat($('#professionalTax').val()) || 0;
			const tds = parseFloat($('#tds').val()) || 0;
			const otherDeductions = parseFloat($('#otherDeductions').val()) || 0;
			const leaveDays = parseInt($('#leaveDays').val()) || 0;
			const loanEmi = parseFloat($('#loanEmi').val()) || 0;

			const leaveDeduction = (basic / 30) * leaveDays;
			const grossEarnings = basic + hra + da + transport + medical + otherAllowances;
			const totalDeductions = pf + professionalTax + tds + otherDeductions + leaveDeduction + loanEmi;

			const record = {
				id: $('#payrollId').val() || 'PAY' + String(Date.now()).slice(-8),
				employeeId: employeeId,
				employeeName: employee.name,
				designation: employee.designation || 'Staff',
				payPeriod: $('#payPeriod').val(),
				basic: basic,
				hra: hra,
				da: da,
				transport: transport,
				medical: medical,
				otherAllowances: otherAllowances,
				pf: pf,
				professionalTax: professionalTax,
				tds: tds,
				otherDeductions: otherDeductions,
				leaveDays: leaveDays,
				leaveDeduction: leaveDeduction,
				loanEmi: loanEmi,
				grossEarnings: grossEarnings,
				totalDeductions: totalDeductions,
				netSalary: grossEarnings - totalDeductions,
				paymentMode: $('#paymentMode').val(),
				status: $('#paymentStatus').val(),
				paidDate: $('#paymentStatus').val() === 'paid' ? new Date().toISOString().split('T')[0] : null,
				remarks: $('#paymentRemarks').val()
			};

			const existingIndex = payrollRecords.findIndex(p => p.id === record.id);
			if (existingIndex >= 0) {
				payrollRecords[existingIndex] = record;
				notify('Salary record updated successfully!', 'success');
			} else {
				payrollRecords.push(record);
				notify('Salary record added successfully!', 'success');
			}

			localStorage.setItem(PAYROLL_KEY, JSON.stringify(payrollRecords));
			closePayrollModal();
			renderTable();
		}

		function markAsPaid(id) {
			const record = payrollRecords.find(p => p.id === id);
			if (record) {
				record.status = 'paid';
				record.paidDate = new Date().toISOString().split('T')[0];
				localStorage.setItem(PAYROLL_KEY, JSON.stringify(payrollRecords));
				notify('Payment marked as paid!', 'success');
				renderTable();
			}
		}

		function viewPayslip(id) {
			const record = payrollRecords.find(p => p.id === id);
			if (!record) return;

			const employee = teachers.find(t => t.id === record.employeeId) || {};
			const [year, month] = record.payPeriod.split('-');
			const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
							   'July', 'August', 'September', 'October', 'November', 'December'];
			const monthName = monthNames[parseInt(month) - 1];

			$('#payslipContent').html(`
				<div class="payslip-container" id="printablePayslip">
					<div class="payslip-header">
						<h1 style="color: #10b981; margin-bottom: 8px;">
							<i class="fas fa-graduation-cap"></i> EduManage Pro
						</h1>
						<p style="color: #64748b;">School/College Management System</p>
						<h2 style="margin-top: 20px; color: #1e293b;">SALARY SLIP</h2>
						<p style="color: #64748b;">For the month of ${monthName} ${year}</p>
					</div>

					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; padding: 20px; background: #f8fafc; border-radius: 12px;">
						<div>
							<p><strong>Employee ID:</strong> ${record.employeeId}</p>
							<p><strong>Name:</strong> ${record.employeeName}</p>
							<p><strong>Designation:</strong> ${record.designation}</p>
						</div>
						<div>
							<p><strong>Pay Period:</strong> ${monthName} ${year}</p>
							<p><strong>Payment Mode:</strong> ${record.paymentMode || 'N/A'}</p>
							<p><strong>Status:</strong> <span style="color: ${record.status === 'paid' ? '#10b981' : '#f59e0b'}">${record.status.toUpperCase()}</span></p>
						</div>
					</div>

					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
						<div style="background: #f0fdf4; padding: 20px; border-radius: 12px;">
							<h3 style="color: #10b981; margin-bottom: 16px; font-size: 16px;">
								<i class="fas fa-plus-circle"></i> Earnings
							</h3>
							<table style="width: 100%;">
								<tr><td>Basic Salary</td><td style="text-align: right;">₹${record.basic.toLocaleString('en-IN')}</td></tr>
								<tr><td>HRA</td><td style="text-align: right;">₹${record.hra.toLocaleString('en-IN')}</td></tr>
								<tr><td>DA</td><td style="text-align: right;">₹${record.da.toLocaleString('en-IN')}</td></tr>
								<tr><td>Transport Allowance</td><td style="text-align: right;">₹${record.transport.toLocaleString('en-IN')}</td></tr>
								<tr><td>Medical Allowance</td><td style="text-align: right;">₹${record.medical.toLocaleString('en-IN')}</td></tr>
								<tr><td>Other Allowances</td><td style="text-align: right;">₹${record.otherAllowances.toLocaleString('en-IN')}</td></tr>
								<tr style="font-weight: bold; border-top: 2px solid #10b981; margin-top: 10px;">
									<td>Gross Earnings</td>
									<td style="text-align: right; color: #10b981;">₹${record.grossEarnings.toLocaleString('en-IN')}</td>
								</tr>
							</table>
						</div>

						<div style="background: #fef2f2; padding: 20px; border-radius: 12px;">
							<h3 style="color: #ef4444; margin-bottom: 16px; font-size: 16px;">
								<i class="fas fa-minus-circle"></i> Deductions
							</h3>
							<table style="width: 100%;">
								<tr><td>Provident Fund</td><td style="text-align: right;">₹${record.pf.toLocaleString('en-IN')}</td></tr>
								<tr><td>Professional Tax</td><td style="text-align: right;">₹${record.professionalTax.toLocaleString('en-IN')}</td></tr>
								<tr><td>TDS</td><td style="text-align: right;">₹${record.tds.toLocaleString('en-IN')}</td></tr>
								<tr><td>Leave Deduction (${record.leaveDays} days)</td><td style="text-align: right;">₹${(record.leaveDeduction || 0).toLocaleString('en-IN')}</td></tr>
								<tr><td>Loan EMI</td><td style="text-align: right;">₹${record.loanEmi.toLocaleString('en-IN')}</td></tr>
								<tr><td>Other Deductions</td><td style="text-align: right;">₹${record.otherDeductions.toLocaleString('en-IN')}</td></tr>
								<tr style="font-weight: bold; border-top: 2px solid #ef4444; margin-top: 10px;">
									<td>Total Deductions</td>
									<td style="text-align: right; color: #ef4444;">₹${record.totalDeductions.toLocaleString('en-IN')}</td>
								</tr>
							</table>
						</div>
					</div>

					<div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 24px; border-radius: 12px; text-align: center; margin-top: 20px;">
						<h3 style="margin-bottom: 8px; font-size: 18px;">NET SALARY</h3>
						<p style="font-size: 36px; font-weight: 700;">₹${record.netSalary.toLocaleString('en-IN')}</p>
						<p style="opacity: 0.8; margin-top: 8px;">In words: ${numberToWords(record.netSalary)} Rupees Only</p>
					</div>

					<div style="margin-top: 40px; display: flex; justify-content: space-between;">
						<div style="text-align: center;">
							<div style="border-top: 1px solid #cbd5e1; width: 150px; margin-bottom: 8px;"></div>
							<p style="color: #64748b; font-size: 12px;">Employee Signature</p>
						</div>
						<div style="text-align: center;">
							<div style="border-top: 1px solid #cbd5e1; width: 150px; margin-bottom: 8px;"></div>
							<p style="color: #64748b; font-size: 12px;">Authorized Signature</p>
						</div>
					</div>

					<p style="text-align: center; color: #94a3b8; font-size: 11px; margin-top: 30px;">
						This is a computer-generated payslip and does not require a signature.
					</p>
				</div>
			`);

			$('#payslipModal').addClass('active');
		}

		function closePayslipModal() {
			$('#payslipModal').removeClass('active');
		}

		function printPayslip() {
			const content = document.getElementById('printablePayslip').innerHTML;
			const printWindow = window.open('', '_blank');
			printWindow.document.write(`
				<html>
				<head>
					<title>Payslip</title>
					<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
					<style>
						body { font-family: 'Segoe UI', sans-serif; padding: 20px; }
						table { border-collapse: collapse; }
						table tr td { padding: 8px 0; }
					</style>
				</head>
				<body>${content}</body>
				</html>
			`);
			printWindow.document.close();
			printWindow.print();
		}

		function printSinglePayslip(id) {
			viewPayslip(id);
			setTimeout(() => printPayslip(), 500);
		}

		function numberToWords(num) {
			const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten',
						  'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
			const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

			if (num === 0) return 'Zero';

			function convertLessThanThousand(n) {
				if (n === 0) return '';
				if (n < 20) return ones[n];
				if (n < 100) return tens[Math.floor(n / 10)] + (n % 10 ? ' ' + ones[n % 10] : '');
				return ones[Math.floor(n / 100)] + ' Hundred' + (n % 100 ? ' ' + convertLessThanThousand(n % 100) : '');
			}

			num = Math.floor(num);
			if (num < 1000) return convertLessThanThousand(num);
			if (num < 100000) return convertLessThanThousand(Math.floor(num / 1000)) + ' Thousand ' + convertLessThanThousand(num % 1000);
			if (num < 10000000) return convertLessThanThousand(Math.floor(num / 100000)) + ' Lakh ' + convertLessThanThousand(Math.floor((num % 100000) / 1000)) + (num % 1000 ? ' Thousand ' : '') + convertLessThanThousand(num % 1000);
			return convertLessThanThousand(Math.floor(num / 10000000)) + ' Crore ' + numberToWords(num % 10000000);
		}

		function resetFilters() {
			$('#searchPayroll').val('');
			$('#filterStatus').val('');
			$('#filterDepartment').val('');
			setCurrentMonth();
			renderTable();
		}

		function toggleSelectAll() {
			const isChecked = $('#selectAll').prop('checked');
			$('.record-checkbox').prop('checked', isChecked);
		}

		function processAllPayroll() {
			const pending = payrollRecords.filter(p => p.status === 'pending' || p.status === 'processing');
			if (pending.length === 0) {
				notify('No pending payments to process', 'info');
				return;
			}

			if (confirm(`Process ${pending.length} pending payment(s)?`)) {
				pending.forEach(p => {
					p.status = 'paid';
					p.paidDate = new Date().toISOString().split('T')[0];
				});
				localStorage.setItem(PAYROLL_KEY, JSON.stringify(payrollRecords));
				notify(`${pending.length} payments processed successfully!`, 'success');
				renderTable();
			}
		}

		function generatePayrollReport() {
			const month = $('#filterMonth').val();
			const year = $('#filterYear').val();
			const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
							   'July', 'August', 'September', 'October', 'November', 'December'];

			let filtered = payrollRecords;
			if (month && year) {
				filtered = payrollRecords.filter(p => p.payPeriod === `${year}-${month}`);
			}

			const csv = [
				['Employee ID', 'Name', 'Designation', 'Basic', 'HRA', 'DA', 'Gross', 'PF', 'Tax', 'Deductions', 'Net Salary', 'Status'].join(','),
				...filtered.map(p => [
					p.employeeId,
					`"${p.employeeName}"`,
					`"${p.designation}"`,
					p.basic,
					p.hra,
					p.da,
					p.grossEarnings,
					p.pf,
					p.tds,
					p.totalDeductions,
					p.netSalary,
					p.status
				].join(','))
			].join('\n');

			const blob = new Blob([csv], { type: 'text/csv' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = `Payroll_Report_${monthNames[parseInt(month) - 1] || 'All'}_${year}.csv`;
			a.click();
			notify('Report exported successfully!', 'success');
		}

		function notify(message, type = 'success') {
			$('.toast-notification').remove();
			const bg = type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6';
			const icon = type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle';

			const toast = $(`
				<div class="toast-notification" style="
					position: fixed;
					top: 20px;
					right: 20px;
					background: ${bg};
					color: white;
					padding: 14px 24px;
					border-radius: 10px;
					box-shadow: 0 4px 12px rgba(0,0,0,0.15);
					z-index: 10000;
					display: flex;
					align-items: center;
					gap: 10px;
					font-weight: 500;
					transform: translateX(120%);
					transition: transform 0.3s ease;
				">
					<i class="fas fa-${icon}"></i>
					${message}
				</div>
			`);

			$('body').append(toast);
			setTimeout(() => toast.css('transform', 'translateX(0)'), 10);
			setTimeout(() => {
				toast.css('transform', 'translateX(120%)');
				setTimeout(() => toast.remove(), 300);
			}, 3000);
		}

		// Auto-load basic salary when employee is selected
		$('#employeeSelect').on('change', function() {
			const salary = $(this).find(':selected').data('salary');
			if (salary) {
				$('#basicSalary').val(salary);
				// Auto-calculate standard allowances
				$('#hra').val(Math.round(salary * 0.2));
				$('#da').val(Math.round(salary * 0.1));
				$('#pf').val(Math.round(salary * 0.12));
				$('#tds').val(Math.round(salary * 0.05));
				calculateNetSalary();
			}
		});
	</script>
</body>
</html>
