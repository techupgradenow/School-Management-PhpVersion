<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Institution Settings - EduManage Pro</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }
        .page-title-section h1 { font-size: 24px; font-weight: 700; color: #1e293b; margin-bottom: 4px; }
        .page-title-section p { font-size: 14px; color: #64748b; }

        .btn {
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            border: none;
        }
        .btn-primary { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4); }
        .btn-outline { background: white; border: 2px solid #e2e8f0; color: #64748b; }
        .btn-outline:hover { border-color: #f59e0b; color: #f59e0b; }
        .btn-success { background: linear-gradient(135deg, #22c55e, #16a34a); color: white; }
        .btn-danger { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }

        .settings-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 24px;
        }

        .settings-nav {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.04);
            padding: 16px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        .settings-nav h3 {
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 12px 16px;
            margin-bottom: 8px;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border-radius: 10px;
            color: #475569;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 4px;
        }
        .nav-item:hover { background: #f8fafc; color: #f59e0b; }
        .nav-item.active { background: linear-gradient(135deg, #fef3c7, #fde68a); color: #d97706; font-weight: 600; }
        .nav-item i { width: 20px; text-align: center; }

        .settings-content {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.04);
        }
        .settings-section {
            display: none;
            padding: 32px;
        }
        .settings-section.active { display: block; }
        .section-header {
            margin-bottom: 32px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f5f9;
        }
        .section-header h2 {
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }
        .section-header p { color: #64748b; font-size: 14px; }

        /* Institution Type Selection */
        .institution-type-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            margin-bottom: 32px;
        }
        .type-card {
            border: 3px solid #e2e8f0;
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        .type-card:hover {
            border-color: #f59e0b;
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.15);
        }
        .type-card.selected {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb, #fef3c7);
        }
        .type-card.selected .type-icon {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        .type-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            background: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: #64748b;
            margin: 0 auto 20px;
            transition: all 0.3s;
        }
        .type-card h3 {
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }
        .type-card p { color: #64748b; font-size: 14px; line-height: 1.6; }
        .type-features {
            margin-top: 16px;
            text-align: left;
        }
        .type-features li {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            font-size: 13px;
            color: #475569;
        }
        .type-features li i { color: #22c55e; }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group.full-width {
            grid-column: span 2;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .form-group label .required { color: #ef4444; }
        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.2s;
        }
        .form-control:focus {
            outline: none;
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }
        textarea.form-control { min-height: 100px; resize: vertical; }

        /* Dropdown Management */
        .dropdown-manager {
            margin-top: 32px;
        }
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .category-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
        }
        .category-header {
            padding: 16px 20px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .category-header h4 { font-size: 15px; font-weight: 600; margin: 0; }
        .category-header .count {
            background: rgba(255,255,255,0.2);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
        }
        .category-values {
            padding: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .value-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 13px;
        }
        .value-item:last-child { margin-bottom: 0; }
        .value-item .delete-value {
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            padding: 4px;
            transition: color 0.2s;
        }
        .value-item .delete-value:hover { color: #ef4444; }
        .category-footer {
            padding: 12px 16px;
            border-top: 1px solid #e2e8f0;
        }
        .add-value-form {
            display: flex;
            gap: 8px;
        }
        .add-value-form input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 13px;
        }
        .add-value-form input:focus {
            outline: none;
            border-color: #f59e0b;
        }
        .add-value-form button {
            width: 36px;
            height: 36px;
            border: none;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .add-value-form button:hover { transform: scale(1.05); }

        /* Status Messages */
        .alert {
            padding: 16px 20px;
            border-radius: 10px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .alert-success { background: #dcfce7; color: #16a34a; border: 1px solid #22c55e; }
        .alert-error { background: #fef2f2; color: #dc2626; border: 1px solid #ef4444; }
        .alert-info { background: #dbeafe; color: #2563eb; border: 1px solid #3b82f6; }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 10px;
            font-weight: 500;
            z-index: 10000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        .toast.show { opacity: 1; transform: translateX(0); }
        .toast.success { background: #dcfce7; color: #16a34a; border: 1px solid #22c55e; }
        .toast.error { background: #fef2f2; color: #dc2626; border: 1px solid #ef4444; }

        @media (max-width: 768px) {
            .settings-container { grid-template-columns: 1fr; }
            .settings-nav { position: static; }
            .form-grid { grid-template-columns: 1fr; }
            .form-group.full-width { grid-column: span 1; }
            .institution-type-cards { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="main-content" style="padding: 24px;">
        <div class="page-header">
            <div class="page-title-section">
                <h1><i class="fas fa-cog" style="color: #f59e0b; margin-right: 12px;"></i>Institution Settings</h1>
                <p>Configure your institution type and manage dropdown values</p>
            </div>
            <div class="header-actions">
                <a href="settings.html" class="btn btn-outline">
                    <i class="fas fa-arrow-left"></i> Back to Settings
                </a>
            </div>
        </div>

        <div class="settings-container">
            <div class="settings-nav">
                <h3>Settings Menu</h3>
                <div class="nav-item active" data-section="institution">
                    <i class="fas fa-building"></i>
                    <span>Institution Type</span>
                </div>
                <div class="nav-item" data-section="basic">
                    <i class="fas fa-info-circle"></i>
                    <span>Basic Information</span>
                </div>
                <div class="nav-item" data-section="dropdowns">
                    <i class="fas fa-list"></i>
                    <span>Dropdown Values</span>
                </div>
                <div class="nav-item" data-section="academic">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Academic Settings</span>
                </div>
            </div>

            <div class="settings-content">
                <!-- Institution Type Section -->
                <div class="settings-section active" id="section-institution">
                    <div class="section-header">
                        <h2><i class="fas fa-building" style="color: #f59e0b; margin-right: 12px;"></i>Institution Type</h2>
                        <p>Select whether you are managing a School or College. This will customize the dashboard and available features.</p>
                    </div>

                    <div id="currentTypeAlert"></div>

                    <div class="institution-type-cards">
                        <div class="type-card" data-type="School">
                            <div class="type-icon">
                                <i class="fas fa-school"></i>
                            </div>
                            <h3>School</h3>
                            <p>Primary & Secondary Education (K-12)</p>
                            <ul class="type-features">
                                <li><i class="fas fa-check"></i> Class-based management</li>
                                <li><i class="fas fa-check"></i> Section organization</li>
                                <li><i class="fas fa-check"></i> Subject-wise scheduling</li>
                                <li><i class="fas fa-check"></i> Parent communication</li>
                                <li><i class="fas fa-check"></i> Report cards</li>
                            </ul>
                        </div>
                        <div class="type-card" data-type="College">
                            <div class="type-icon">
                                <i class="fas fa-university"></i>
                            </div>
                            <h3>College</h3>
                            <p>Higher Education Institution</p>
                            <ul class="type-features">
                                <li><i class="fas fa-check"></i> Department management</li>
                                <li><i class="fas fa-check"></i> Course & Semester system</li>
                                <li><i class="fas fa-check"></i> Faculty allocation</li>
                                <li><i class="fas fa-check"></i> Credit-based grading</li>
                                <li><i class="fas fa-check"></i> Transcript generation</li>
                            </ul>
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <button type="button" class="btn btn-primary" id="saveInstitutionType">
                            <i class="fas fa-save"></i> Save Institution Type
                        </button>
                    </div>
                </div>

                <!-- Basic Information Section -->
                <div class="settings-section" id="section-basic">
                    <div class="section-header">
                        <h2><i class="fas fa-info-circle" style="color: #f59e0b; margin-right: 12px;"></i>Basic Information</h2>
                        <p>Enter your institution's basic details</p>
                    </div>

                    <form id="basicInfoForm">
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="institutionName">Institution Name <span class="required">*</span></label>
                                <input type="text" id="institutionName" class="form-control" placeholder="Enter institution name" required>
                            </div>
                            <div class="form-group full-width">
                                <label for="institutionAddress">Address</label>
                                <textarea id="institutionAddress" class="form-control" placeholder="Enter full address"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="institutionPhone">Phone Number</label>
                                <input type="tel" id="institutionPhone" class="form-control" placeholder="Enter phone number">
                            </div>
                            <div class="form-group">
                                <label for="institutionEmail">Email Address</label>
                                <input type="email" id="institutionEmail" class="form-control" placeholder="Enter email address">
                            </div>
                            <div class="form-group">
                                <label for="institutionWebsite">Website</label>
                                <input type="url" id="institutionWebsite" class="form-control" placeholder="https://www.example.com">
                            </div>
                            <div class="form-group">
                                <label for="principalName">Principal/Director Name</label>
                                <input type="text" id="principalName" class="form-control" placeholder="Enter name">
                            </div>
                        </div>
                        <div style="margin-top: 24px;">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Information
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Dropdown Values Section -->
                <div class="settings-section" id="section-dropdowns">
                    <div class="section-header">
                        <h2><i class="fas fa-list" style="color: #f59e0b; margin-right: 12px;"></i>Dropdown Values Management</h2>
                        <p>Add or remove values for various dropdown fields used throughout the system. Click the + button to add new values.</p>
                    </div>

                    <div class="category-grid" id="dropdownCategories">
                        <!-- Categories will be loaded dynamically -->
                        <div style="grid-column: span 3; text-align: center; padding: 40px;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 32px; color: #f59e0b;"></i>
                            <p style="margin-top: 16px; color: #64748b;">Loading dropdown categories...</p>
                        </div>
                    </div>
                </div>

                <!-- Academic Settings Section -->
                <div class="settings-section" id="section-academic">
                    <div class="section-header">
                        <h2><i class="fas fa-calendar-alt" style="color: #f59e0b; margin-right: 12px;"></i>Academic Settings</h2>
                        <p>Configure academic year and related settings</p>
                    </div>

                    <form id="academicForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="academicYear">Current Academic Year <span class="required">*</span></label>
                                <select id="academicYear" class="form-control">
                                    <option value="2023-2024">2023-2024</option>
                                    <option value="2024-2025" selected>2024-2025</option>
                                    <option value="2025-2026">2025-2026</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="academicStartMonth">Academic Year Start Month</label>
                                <select id="academicStartMonth" class="form-control">
                                    <option value="1">January</option>
                                    <option value="4" selected>April</option>
                                    <option value="6">June</option>
                                    <option value="7">July</option>
                                    <option value="9">September</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="workingDays">Working Days per Week</label>
                                <select id="workingDays" class="form-control">
                                    <option value="5">5 Days (Mon-Fri)</option>
                                    <option value="6" selected>6 Days (Mon-Sat)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="gradingSystem">Grading System</label>
                                <select id="gradingSystem" class="form-control">
                                    <option value="percentage">Percentage Based</option>
                                    <option value="grade">Grade Based (A, B, C)</option>
                                    <option value="cgpa">CGPA System</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top: 24px;">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Academic Settings
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
    $(document).ready(function() {
        const API_BASE = '../backend/api';
        let currentInstitutionType = 'School';
        let dropdownData = {};

        // Initialize
        loadSettings();
        loadDropdowns();

        // Navigation
        $('.nav-item').on('click', function() {
            const section = $(this).data('section');
            $('.nav-item').removeClass('active');
            $(this).addClass('active');
            $('.settings-section').removeClass('active');
            $('#section-' + section).addClass('active');
        });

        // Institution type card selection
        $('.type-card').on('click', function() {
            $('.type-card').removeClass('selected');
            $(this).addClass('selected');
        });

        // Save institution type
        $('#saveInstitutionType').on('click', function() {
            const selectedType = $('.type-card.selected').data('type');
            if (!selectedType) {
                showToast('Please select an institution type', 'error');
                return;
            }

            const $btn = $(this);
            $btn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Saving...');

            $.ajax({
                url: API_BASE + '/institution.php',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    action: 'set_type',
                    type: selectedType
                }),
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        currentInstitutionType = selectedType;
                        localStorage.setItem('institutionType', selectedType);
                        showToast('Institution type set to ' + selectedType, 'success');
                        $('#currentTypeAlert').html(
                            '<div class="alert alert-success">' +
                            '<i class="fas fa-check-circle"></i> ' +
                            'Institution is configured as: <strong>' + selectedType + '</strong>' +
                            '</div>'
                        );
                        // Reload dropdowns for new type
                        loadDropdowns();
                    } else {
                        showToast(response.message, 'error');
                    }
                },
                error: function() {
                    showToast('Error saving institution type', 'error');
                },
                complete: function() {
                    $btn.prop('disabled', false).html('<i class="fas fa-save"></i> Save Institution Type');
                }
            });
        });

        // Load settings
        function loadSettings() {
            $.ajax({
                url: API_BASE + '/institution.php',
                type: 'GET',
                data: { action: 'settings' },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        const settings = response.data;
                        currentInstitutionType = settings.institution_type || 'School';

                        // Select current type
                        $('.type-card[data-type="' + currentInstitutionType + '"]').addClass('selected');
                        $('#currentTypeAlert').html(
                            '<div class="alert alert-info">' +
                            '<i class="fas fa-info-circle"></i> ' +
                            'Current institution type: <strong>' + currentInstitutionType + '</strong>' +
                            '</div>'
                        );

                        // Fill basic info
                        $('#institutionName').val(settings.institution_name || '');
                        $('#institutionAddress').val(settings.institution_address || '');
                        $('#institutionPhone').val(settings.institution_phone || '');
                        $('#institutionEmail').val(settings.institution_email || '');
                        $('#academicYear').val(settings.academic_year || '2024-2025');
                    }
                }
            });
        }

        // Load dropdown categories and values
        function loadDropdowns() {
            $.ajax({
                url: API_BASE + '/dropdowns.php',
                type: 'GET',
                data: { action: 'all' },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        dropdownData = response.data.dropdowns;
                        renderDropdownCategories();
                    } else {
                        $('#dropdownCategories').html(
                            '<div style="grid-column: span 3; text-align: center; padding: 40px; color: #ef4444;">' +
                            '<i class="fas fa-exclamation-triangle" style="font-size: 32px;"></i>' +
                            '<p style="margin-top: 16px;">Error loading dropdowns. Please run the database setup first.</p>' +
                            '</div>'
                        );
                    }
                },
                error: function() {
                    $('#dropdownCategories').html(
                        '<div style="grid-column: span 3; text-align: center; padding: 40px; color: #ef4444;">' +
                        '<i class="fas fa-exclamation-triangle" style="font-size: 32px;"></i>' +
                        '<p style="margin-top: 16px;">Error loading dropdowns. Please check API connection.</p>' +
                        '</div>'
                    );
                }
            });
        }

        // Render dropdown categories
        function renderDropdownCategories() {
            let html = '';
            $.each(dropdownData, function(key, category) {
                const values = category.values || [];
                html += `
                    <div class="category-card" data-category="${key}">
                        <div class="category-header">
                            <h4>${category.category_name}</h4>
                            <span class="count">${values.length} items</span>
                        </div>
                        <div class="category-values">
                            ${values.length > 0 ? values.map(v => `
                                <div class="value-item" data-id="${v.id}">
                                    <span>${v.value}</span>
                                    <button class="delete-value" data-id="${v.id}" title="Delete">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            `).join('') : '<div style="text-align: center; padding: 20px; color: #94a3b8;">No values yet</div>'}
                        </div>
                        <div class="category-footer">
                            <form class="add-value-form" data-category="${key}">
                                <input type="text" placeholder="Add new ${category.category_name.toLowerCase()}..." required>
                                <button type="submit"><i class="fas fa-plus"></i></button>
                            </form>
                        </div>
                    </div>
                `;
            });

            if (!html) {
                html = '<div style="grid-column: span 3; text-align: center; padding: 40px; color: #64748b;">' +
                       '<i class="fas fa-inbox" style="font-size: 32px;"></i>' +
                       '<p style="margin-top: 16px;">No dropdown categories found for ' + currentInstitutionType + '</p>' +
                       '</div>';
            }

            $('#dropdownCategories').html(html);
        }

        // Add new value
        $(document).on('submit', '.add-value-form', function(e) {
            e.preventDefault();
            const $form = $(this);
            const category = $form.data('category');
            const $input = $form.find('input');
            const value = $input.val().trim();

            if (!value) return;

            $.ajax({
                url: API_BASE + '/dropdowns.php',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    action: 'add_value',
                    category_key: category,
                    value: value
                }),
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        showToast(response.message, 'success');
                        $input.val('');
                        loadDropdowns(); // Refresh
                    } else {
                        showToast(response.message, 'error');
                    }
                },
                error: function() {
                    showToast('Error adding value', 'error');
                }
            });
        });

        // Delete value
        $(document).on('click', '.delete-value', function() {
            const id = $(this).data('id');
            const $item = $(this).closest('.value-item');

            if (!confirm('Are you sure you want to delete this value?')) return;

            $.ajax({
                url: API_BASE + '/dropdowns.php?id=' + id,
                type: 'DELETE',
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        showToast('Value deleted', 'success');
                        $item.fadeOut(300, function() {
                            $(this).remove();
                            loadDropdowns(); // Refresh counts
                        });
                    } else {
                        showToast(response.message, 'error');
                    }
                },
                error: function() {
                    showToast('Error deleting value', 'error');
                }
            });
        });

        // Save basic info
        $('#basicInfoForm').on('submit', function(e) {
            e.preventDefault();

            const settings = {
                institution_name: $('#institutionName').val(),
                institution_address: $('#institutionAddress').val(),
                institution_phone: $('#institutionPhone').val(),
                institution_email: $('#institutionEmail').val()
            };

            $.ajax({
                url: API_BASE + '/institution.php',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    action: 'update',
                    settings: settings
                }),
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        showToast('Basic information saved', 'success');
                    } else {
                        showToast(response.message, 'error');
                    }
                },
                error: function() {
                    showToast('Error saving information', 'error');
                }
            });
        });

        // Save academic settings
        $('#academicForm').on('submit', function(e) {
            e.preventDefault();

            const settings = {
                academic_year: $('#academicYear').val(),
                academic_start_month: $('#academicStartMonth').val(),
                working_days: $('#workingDays').val(),
                grading_system: $('#gradingSystem').val()
            };

            $.ajax({
                url: API_BASE + '/institution.php',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    action: 'update',
                    settings: settings
                }),
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        showToast('Academic settings saved', 'success');
                    } else {
                        showToast(response.message, 'error');
                    }
                },
                error: function() {
                    showToast('Error saving settings', 'error');
                }
            });
        });

        // Toast notification
        function showToast(message, type) {
            const $toast = $('<div class="toast ' + type + '">' + message + '</div>');
            $('body').append($toast);

            setTimeout(function() {
                $toast.addClass('show');
            }, 10);

            setTimeout(function() {
                $toast.removeClass('show');
                setTimeout(function() {
                    $toast.remove();
                }, 300);
            }, 3000);
        }
    });
    </script>
</body>
</html>
